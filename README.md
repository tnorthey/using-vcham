# using-vcham
How to use VCHam - a program to calculate the vibronic coupling Hamiltonian.

## VCHam toolbox

**vcpnt101**, generates quantum chemistry input files (e.g. g09) for point along a chosen normal mode

**vctrans101**, reads data from quantum chemistry output files (generated by vcpnt) and formats for use in vchfit

**vchfit**, fits curves to potential energy curves along a normal mode 

## Example usage

	vcpnt101 pnts.inp

will generate input files along a chosen normal mode according to pnts.inp; 
Here is an example pnts.inp file:

	file0 = structure1.log
	nmodes = 30
	fileout = structure1
	opening = open.dat
	closing = close.dat
	formout = gaussian
	along 01 10 1.0

	end-input

Where,

- **file0**, the output for a R0 frequency calculation (e.g. opt, freq in g09);

- **nmodes**, the total number of normal modes (3N-6 for non-linear molecules)

- **fileout**, the title of the files to be generated by vcpnt. They will be this title followed by the mode number and the number of deviations left or right from the R0 position (as read from file0 = structure1.log) separated by underscores.

- **opening**, this specifies a special file containing the opening for a g09 template input file (before the geometry section).

- **closing**, this specifies a special file containing the closing for a g09 template input file (after the geometry section).

- **formout**, specifies the format of the files generated by vcpnt; in this case gaussian 

- **along**, specifies the mode number, number of deviations (left and right) from the R0 position, and the spacing (not sure of units, normal mode coordinates?) 1.0 is a standard value


Then, run the generated g09 calculations. 
Next, use vctrans to transform the data from the g09 output files to nice format and for use in vchfit,

	vctrans101 trans.inp

As this must be done for every mode, use a template file such as 'trans_xx.inp', which contains 'xx' in place of where the mode number should be. Then we can just, 

	for i in {1..30}
	do
	sed "s/xx/$i/g" trans_xx.inp > trans_$i.inp
	done

The trans.inp files reference a 'q.set' file which is a list of g09 log files which VCHam reads from. Similarly, just use a template file 'qxx.set' and,

        for i in {1..30}
        do
        sed "s/xx/$i/g" qxx.set > q$i.set
        done

Then,

        for i in {1..30}
        do
        vctrans101 trans_$i.inp
        done

To generate a 'trans.info' file for each mode. They can be plotted with vcplot, e.g. 

	vcplot101 trans_1.inp

## Fitting

To fit the PECs along each normal mode, fit.inp files must be used, which look like:

	infofile = trans_1.info
	adiab2_mod
	mctdh_op
	
	iter = 64
	
	fit_select = 1
	
	symmode = A
	
	cpmode = 1 2 B  cpmode = 1 3 A  cpmode = 1 4 B  cpmode = 1 5 B
	cpmode = 2 3 B  cpmode = 2 4 A  cpmode = 2 5 A
	cpmode = 3 4 B  cpmode = 3 5 B
	cpmode = 4 5 A
	
	diabatic_function
	end-define
	
	kappafit
	lambdafit
	
	#guess=fit01-1.vcham
	#use_cons
	
	constraints-section
	end-constraints-section
	
	end-input

We actually use three of these for different fitting algorithms, eventually obtaining a good final fit. They differ by lambdafit (fit01), then gammafit (fit02), then we fill out the diabatic_function section to use quartic terms (fit03),

	diabatic_function
	01 1 quartic
	01 2 quartic
	01 3 quartic
	01 4 quartic
	01 5 quartic
	end-define

To fit we have to generate fit01, fit02, and fit03 for each mode e.g. fit-1-1.inp, fit-1-2.inp, fit-1-3.inp, fit-2-1.inp, fit-2-2.inp, fit-2-3.inp, ... , up to fit-30-1.inp, fit-30-2.inp, fit-30-3.inp. Use a template file and sed again,

	for i in {1..30}
        do
        sed "s/xx/$i/g" fit_xx-1.inp > fit_$i-1.inp
        sed "s/xx/$i/g" fit_xx-2.inp > fit_$i-2.inp
        sed "s/xx/$i/g" fit_xx-3.inp > fit_$i-3.inp
        done

Then run the fitting e.g.,

	for i in fit*.inp 
	do
	vchfit101 $i
	done

This works because fit_xx-1.inp is listed before fit_xx-2.inp which are both before fit_xx-3.inp in bash; try it by

	ls -l fit*.inp

The fittings must be in order 1,2,3, because fit 2 uses info from fitting 1 as a first guess, and fitting 3 uses fit2 as a first guess.


